<?xml version="1.0"?>
<odoo>
   <record id="view_estate_property_tree" model="ir.ui.view">
      <field name="name">estate.property.tree</field>
      <field name="model">estate.property</field>
      <field name="arch" type="xml">
         <tree decoration-success="state in ['offer accepted','offer received']"
            decoration-muted="state == 'sold'" decoration-bf="state == 'offer accepted'">
            <header>
               <button type="object" name="action_add_offer" class="oe_highlight" string="Add Offer"/>                  
            </header>
            <field name="name" />
            <field name="state" column_invisible="1" />
            <field name="postcode" />
            <field name="living_area" />
            <field name="property_type_id" />
            <field name="date_availability" optional="True" />
            <field name="bedrooms" />
            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" />
         </tree>
      </field>
   </record>
   <record id="view_estate_property_form" model="ir.ui.view">
      <field name="name">estate.property.form</field>
      <field name="model">estate.property</field>
      <field name="arch" type="xml">
         <form string="Estate">
            <header>
               <button name="action_sold" type="object" class="oe_highlight" string="Sold"
                  invisible="state in ['sold','cancelled']" />
               <button name="action_cancel_property" type="object" string="Cancel"
                  invisible="state in ['sold','cancelled']" />
               <field name="state" widget="statusbar" options="{'clickable': '1'}" />
            </header>
            <sheet>
               <div class="oe_title">
                  <h1>
                     <field name="name" />
                  </h1>
               </div>
               <group>
                  <group>
                     <field name="tag_ids" widget="many2many_tags"
                        options="{'color_field': 'color'}" />
                     <field name="property_type_id" options="{'no_create': True, 'no_open': True}" />
                     <field name="postcode" />
                     <field name="date_availability" />
                  </group>
                  <group>
                     <field name="company_id"/>
                     <field name="expected_price" />
                     <field name="selling_price" />
                     <field name="best_price" />
                     <field name="active" />
                  </group>
               </group>
               <notebook>
                  <page string="Description">
                     <group>
                        <field name="description" />
                        <field name="bedrooms" />
                        <field name="living_area" />
                        <field name="facades" />
                        <field name="garage" />
                        <field name="garden" />
                        <field name="garden_area" invisible="garden == False" />
                        <field name="garden_orientation" invisible="garden == False" />
                        <field name="total_area" />
                     </group>
                  </page>
                  <page string="Other info">
                     <group>
                        <field name="user_id" />
                        <field name="partner_id" />
                     </group>
                  </page>
                  <page string="Offer">
                     <field name="offer_ids"
                        readonly="state in ['sold','cancelled','offer accepted']">
                        <tree editable="bottom" decoration-success="status == 'accepted'"
                           decoration-danger="status == 'refused'">
                           <field name="price" />
                           <button name="action_accept" string="Accept" type="object"
                              icon="fa-check" invisible="status in ['accepted','refused']" />
                           <button name="action_refuse" string="Refuse" type="object"
                              icon="oi-close" invisible="status in ['accepted','refused']" />
                           <field name="status" optional="status in ['accepted','refused']" />
                           <field name="partner_id" />
                           <field name="validity" />
                           <field name="date_deadline" />
                        </tree>
                     </field>
                  </page>
               </notebook>
            </sheet>
         </form>
      </field>
   </record>
   <record id="estate_property_view_kanban" model="ir.ui.view">
      <field name="name">estate.property.kanban</field>
      <field name="model">estate.property</field>
      <field name="arch" type="xml">
         <kanban default_group_by="property_type_id" records_draggable="0" groups_draggable="0">
            <field name="property_type_id" />
            <field name="state" />
            <field name="selling_price" />
            <field name="best_price" />
            <templates>
               <t t-name="kanban-box">
                  <div class="oe_kanban_global_click">
                     <div class="oe_kanban_details">
                        <strong class="o_kanban_record_title">
                           <field name="name"/>
                        </strong>
                     </div>
                     <div>
                        <strong>Expected Price:</strong>
                        <field name="expected_price" />
                     </div>
                     <div class="col-6">
                        <field name="tag_ids" widget="many2many_tags"
                           options="{'color_field': 'color'}" />
                     </div>
                     <div t-if="record.state.raw_value == 'offer accepted'">
                        <strong>Selling Price:</strong>
                        <field name="selling_price" />
                     </div>
                     <div t-if="record.state.raw_value == 'offer received'">
                        <strong>Best Price:</strong>
                        <field name="best_price" />
                     </div>
                  </div>
               </t>
            </templates>
         </kanban>
      </field>
   </record>

   <record id="view_estate_property_search" model="ir.ui.view">
      <field name="name">estate.property.search</field>
      <field name="model">estate.property</field>
      <field name="arch" type="xml">
         <search string="Estate Property">
            <field name="name" string="Name" />
            <field name="postcode" string="Postcode" />
            <field name="selling_price" string="Selling price" />
            <field name="living_area" string="Living Area"
               filter_domain="[('living_area', '>=', self)]" />
            <filter string="Available properties" name="available_properties"
               domain="[('state', 'in',['new','offer received'])]" />
            <group string="Group By Postcode">
               <filter string="Postcode" name="Postcode" context="{'group_by':'postcode'}" />
            </group>
         </search>
      </field>
   </record>
   <record id="estate_property_action" model="ir.actions.act_window">
      <field name="name">Estate</field>
      <field name="res_model">estate.property</field>
      <field name="view_mode">tree,form,kanban</field>
      <field name="help" type="html">
         <p class="o_view_nocontent_smiling_face">
            Create a property
         </p>
      </field>
      <field name="context">{'search_default_available_properties': True}</field>
   </record>
</odoo>
